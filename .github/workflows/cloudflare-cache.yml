name: ğŸ—‘ï¸ Cloudflare Cache Purge

on:
  push:
    branches: [ master ]
  workflow_dispatch: # Permite execuÃ§Ã£o manual

jobs:
  purge-cache:
    runs-on: ubuntu-latest
    name: ğŸ§¹ Limpar Cache Cloudflare
    
    steps:
      - name: ğŸ“‹ Checkout Repository
        uses: actions/checkout@v4
        
      - name: ï¿½ Verificar Commit Info
        id: commit
        run: |
          echo "commit_message=$(git log -1 --pretty=%B)" >> $GITHUB_OUTPUT
          echo "commit_author=$(git log -1 --pretty=%an)" >> $GITHUB_OUTPUT
          echo "commit_hash=$(git log -1 --pretty=%h)" >> $GITHUB_OUTPUT
        
      - name: ï¿½ğŸ—‘ï¸ Purge Cloudflare Cache
        uses: jakejarvis/cloudflare-purge-action@master
        env:
          CLOUDFLARE_ZONE: ${{ secrets.CLOUDFLARE_ZONE_ID }}
          CLOUDFLARE_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          
      - name: âœ… Cache Purge Success
        run: |
          echo "ğŸ‰ Cache da Cloudflare limpo com sucesso!"
          echo "ğŸš€ Site atualizado em: https://dudaberger.com.br"
          echo "â° Timestamp: $(date)"
          echo "ğŸ‘¤ Autor: ${{ steps.commit.outputs.commit_author }}"
          echo "ğŸ’¬ Commit: ${{ steps.commit.outputs.commit_message }}"
          echo "ğŸ”— Hash: ${{ steps.commit.outputs.commit_hash }}"
          echo ""
          echo "ğŸ“Š PrÃ³ximos acessos ao site terÃ£o conteÃºdo 100% atualizado!"